/**************************************************************************//**
 *
 *       Copyright 2012 GEO RM2000 Team
 *
 * File Name:
 *      fw_util.c
 * 
 * Brief:
 *      
 * 
 * History:
 *      
 *****************************************************************************/

/******************************************************************************
 * Include files                                                              *
 *****************************************************************************/
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>

#include <unistd.h>
#include <stdlib.h>

/******************************************************************************
 * Declaration                                                                *
 *****************************************************************************/


/******************************************************************************
 * Types & Defines                                                            *
 *****************************************************************************/


/******************************************************************************
 * Local  variable                                                            *
 *****************************************************************************/


/******************************************************************************
 * Local  function                                                            *
 *****************************************************************************/


/******************************************************************************
 * Global variable                                                            *
 *****************************************************************************/


/******************************************************************************
 * Global function                                                            *
 *****************************************************************************/
int fw_util_demonize(void)
{
    int   fd;
    pid_t pid;

    umask(0);
    
    fd = open("/dev/null", O_RDWR);
    if(fd < 0){
        return -1;
    }
    
    close(0);
    close(1);
    close(2);
    dup2(fd, 0);
    dup2(fd, 1);
    dup2(fd, 2);

    pid = fork();
    if(pid < 0){
        return -1;
    }else{
        if(pid != 0){
            exit(0);
        }
    }

    if(setsid() < 0){
        return -1;
    }

    pid = fork();
    if(pid < 0){
        return -1;
    }else{
        if(pid != 0){
            exit(0);
        }
    }

    //SIG Set
    
    return 0;
}

/* End of fw_util.c */

